"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[90],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>m});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=p(a),m=r,f=u["".concat(l,".").concat(m)]||u[m]||d[m]||o;return a?n.createElement(f,s(s({ref:t},c),{},{components:a})):n.createElement(f,s({ref:t},c))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,s=new Array(o);s[0]=u;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:r,s[1]=i;for(var p=2;p<o;p++)s[p]=a[p];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},2875:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const o={id:"fs-set-state",title:"Update State",sidebar_label:"Update State",slug:"/update-feature-state"},s=void 0,i={unversionedId:"fs-set-state",id:"fs-set-state",title:"Update State",description:"Use setState to update the state of a Feature Store right away.",source:"@site/docs/fs-set-state.md",sourceDirName:".",slug:"/update-feature-state",permalink:"/docs/update-feature-state",draft:!1,editUrl:"https://github.com/spierala/mini-rx-store/edit/master/docs/docs/fs-set-state.md",tags:[],version:"current",frontMatter:{id:"fs-set-state",title:"Update State",sidebar_label:"Update State",slug:"/update-feature-state"},sidebar:"docs",previous:{title:"Setup",permalink:"/docs/feature-store-setup"},next:{title:"Select",permalink:"/docs/select-feature-state"}},l={},p=[{value:"Use an Observable to update state",id:"use-an-observable-to-update-state",level:3},{value:"Undo setState Actions with <code>undo</code>",id:"undo-setstate-actions-with-undo",level:3}],c={toc:p};function d(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Use ",(0,r.kt)("inlineCode",{parentName:"p"},"setState")," to update the state of a Feature Store right away.\n",(0,r.kt)("inlineCode",{parentName:"p"},"setState")," accepts a Partial Type. This allows us to pass only some properties of a bigger state interface."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-feature-store.ts"',title:'"todo-feature-store.ts"'},"selectTodo(id: number) {\n  this.setState({selectedTodoId: id});\n}\n")),(0,r.kt)("p",null,"Do you need to update the state based on the current state?\n",(0,r.kt)("inlineCode",{parentName:"p"},"setState")," accepts a callback function which gives you access to the current state."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-feature-store.ts"',title:'"todo-feature-store.ts"'},"// Update state based on current state\naddTodo(todo: Todo) {\n  this.setState(state => ({\n    todos: [...state.todos, todo]\n  }))\n}\n")),(0,r.kt)("p",null,"For better logging in the JS Console / Redux DevTools you can provide an optional name to the ",(0,r.kt)("inlineCode",{parentName:"p"},"setState")," function:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"this.setState({selectedTodoId: id}, 'selectTodo');\n")),(0,r.kt)("h3",{id:"use-an-observable-to-update-state"},"Use an Observable to update state"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"setState")," also accepts an Observable. This can be useful if your feature state depends on the values of an Observable.\nYou just have to make sure that the Observable which is passed to ",(0,r.kt)("inlineCode",{parentName:"p"},"setState")," emits values with the Partial type of your state interface."),(0,r.kt)("p",null,"Example code from the MiniRx Demo: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'import { FeatureStore } from "mini-rx-store";\nimport { map, Observable, timer } from "rxjs";\n\ninterface ArtState {\n  opacity: number;\n}\n\nconst initialState: ArtState = {\n  opacity: 1,\n};\n\nexport class ArtStoreService extends FeatureStore<ArtState> {\n  opacity$: Observable<number> = this.select((state) => state.opacity);\n\n  constructor() {\n      super(\'art\', initialState);\n\n      const delayedOpacity$: Observable<ArtState> = timer(Math.random() * 5000).pipe(\n          map(() => ({ opacity: Math.random() })) // map data to Partial<ArtState>\n      );\n\n      this.setState(delayedOpacity$); // setState will be triggerd by the Observable\n  }\n}\n')),(0,r.kt)("p",null,"In this example you can see that there is no further subscription code needed on ",(0,r.kt)("inlineCode",{parentName:"p"},"delayedOpacity$"),".\nThe subscription (and the cleanup of the subscription) happens internally."),(0,r.kt)("h3",{id:"undo-setstate-actions-with-undo"},"Undo setState Actions with ",(0,r.kt)("inlineCode",{parentName:"h3"},"undo")),(0,r.kt)("p",null,"We can easily undo ",(0,r.kt)("inlineCode",{parentName:"p"},"setState")," actions with the ",(0,r.kt)("a",{parentName:"p",href:"ext-undo-extension"},"Undo Extension")," installed."),(0,r.kt)("p",null,"Calling ",(0,r.kt)("inlineCode",{parentName:"p"},"setState")," returns an action which can be used to perform an Undo."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todo-feature-store.ts"',title:'"todo-feature-store.ts"'},"import { Action } from 'mini-rx-store';\n\nremoveTodo(id: number): Action {\n  return this.setState(state => ({\n    todos: state.todos.filter(item => item.id !== id)\n  }))\n}\n\nremoveAndUndo() {\n  const todoRemoveAction: Action = this.removeTodo(2);\n  this.undo(todoRemoveAction);   \n}\n")))}d.isMDXComponent=!0}}]);